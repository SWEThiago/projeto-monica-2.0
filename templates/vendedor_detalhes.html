{% extends 'base.html' %}

{% block content %}
<div class="vendedor-detalhes-container">
    <h2>Detalhes do Vendedor: {{ vendedor.nome }}</h2>

    <div class="leads-info">
        <p>Total de Leads: {{ total_leads }}</p>
        <p>Leads Abertos: {{ quantidade_aberto }}</p>
        <p>Leads Convertidos: {{ quantidade_convertido }}</p>
        <p>Leads Perdidos: {{ quantidade_perdido }}</p>
    </div>

    <h3>Leads Atribuídos</h3>
    <table class="table-leads">
        <thead>
            <tr>
                <th>Nome do Lead</th>
                <th>Veículo</th>
                <th>Modelo</th>
                <th>Status</th>
                <th>Faturado</th>
                <th>Cliente Faturado</th>
                <th>Nota Fiscal</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for lead in leads %}
            <tr>
                <td>{{ lead.nome }}</td>
                <td>{{ lead.veiculo }}</td>
                <td>{{ lead.modelo }}</td>
                <td>
                    <form method="POST" action="{{ url_for('atualizar_lead', vendedor_id=vendedor.id) }}">
                        <input type="hidden" name="lead_id" value="{{ lead.id }}">
                        <select name="status_{{ lead.id }}">
                            <option value="Aberto" {% if lead.status == 'Aberto' %}selected{% endif %}>Aberto</option>
                            <option value="Convertido" {% if lead.status == 'Convertido' %}selected{% endif %}>Convertido</option>
                            <option value="Perdido" {% if lead.status == 'Perdido' %}selected{% endif %}>Perdido</option>
                        </select>
                        <button type="submit">Salvar</button>
                    </form>
                </td>
                <td>
                    <form method="POST" action="{{ url_for('atualizar_lead', vendedor_id=vendedor.id) }}">
                        <input type="hidden" name="lead_id" value="{{ lead.id }}">
                        <select name="faturado_{{ lead.id }}">
                            <option value="Sim" {% if lead.faturado == 'Sim' %}selected{% endif %}>Sim</option>
                            <option value="Nao" {% if lead.faturado == 'Nao' %}selected{% endif %}>Não</option>
                        </select>
                        <button type="submit">Salvar</button>
                    </form>
                </td>
                <td>{{ lead.cliente_faturado }}</td>
                <td>{{ lead.nota_fiscal }}</td>
                <td>
                    <form method="POST" action="{{ url_for('remover_lead', vendedor_id=vendedor.id, lead_id=lead.id) }}">
                        <button type="submit" class="botao-remover">Remover</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="8">Nenhum lead encontrado.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h3>Desempenho do Vendedor</h3>
    <div class="grafico-performance-container">
        <canvas id="graficoPerformanceVendedor"></canvas>
    </div>
</div>

<script>
    // Exemplo de script para gerar o gráfico de desempenho do vendedor (usando Chart.js)
    document.addEventListener('DOMContentLoaded', function () {
        const ctx = document.getElementById('graficoPerformanceVendedor').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Abertos', 'Convertidos', 'Perdidos'],
                datasets: [{
                    label: 'Leads',
                    data: [{{ quantidade_aberto }}, {{ quantidade_convertido }}, {{ quantidade_perdido }}],
                    backgroundColor: ['#FFCE56', '#4CAF50', '#F7464A'],
                    borderColor: ['#FFCE56', '#4CAF50', '#F7464A'],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Status dos Leads'
                        }
                    },
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Quantidade de Leads'
                        }
                    }
                }
            }
        });
    });
</script>
{% endblock %}
